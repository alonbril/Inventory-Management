{% extends "base.html" %}
{% block content %}

<h1>Loans</h1>

<div class="actions">
    <a href="{{ url_for('loans_history') }}" class="button history">View Loans History</a>
    <a href="{{ url_for('add_loan') }}" class="button add">Add New Loan</a>
</div>

{% if loans %}
<div class="table-container loans-table">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Green Number</th>
                <th>Item Name</th>
                <th>Borrower</th>
                <th>Loan Date</th>
                <th>Status</th>
                <th>Days Active</th>
                <th>Signature</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for loan in loans %}
            <tr class="clickable-row" onclick="window.location.href='{{ url_for('loan_details', id=loan['id']) }}'">
                <td>{{ loan['id'] }}</td>
                <td>{{ loan['green_number'] }}</td>
                <td>{{ loan['item_name'] }}</td>
                <td>{{ loan['borrower_name'] }}</td>
                <td>{{ loan['loan_date'] }}</td>
                <td>{{ loan['status'] }}</td>
                <td>{{ loan['days_active'] }} days</td>
                <td>
                    {% if loan['signature'] %}
                        <img src="{{ loan['signature'] }}" alt="Signature" style="max-height: 35px;">
                    {% else %}
                        No signature
                    {% endif %}
                </td>
                <td class="actions-cell">
                    {% if loan['status'] == 'active' %}
                        {% if loan['days_active'] > 7 %}
                            <a href="{{ url_for('extend_loan', id=loan['id']) }}" class="button edit"
                               onclick="event.stopPropagation(); return confirm('Extend this loan for one more week?')">Extend</a>
                        {% endif %}
                        <a href="{{ url_for('return_loan', id=loan['id']) }}" class="button edit"
                           onclick="event.stopPropagation(); return confirm('Mark this loan as returned?')">Return</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p>No active loans.</p>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Prevent action buttons from triggering row click
    document.querySelectorAll('.actions .button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });
});
</script>
{% endblock %}